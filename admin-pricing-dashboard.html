<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Pricing Dashboard - Aaao Backend</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .nav-tab.active {
            background: #007bff;
            color: white;
        }

        .tab-content {
            padding: 30px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #007bff;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .service-rates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .service-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .service-card:hover {
            border-color: #007bff;
            box-shadow: 0 5px 15px rgba(0,123,255,0.1);
        }

        .service-card h4 {
            color: #007bff;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pricing-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .pricing-card:hover {
            border-color: #28a745;
            box-shadow: 0 5px 15px rgba(40,167,69,0.1);
        }

        .pricing-card h4 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.1rem;
            text-transform: capitalize;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        .pricing-card p {
            margin: 8px 0;
            font-size: 0.95rem;
            color: #495057;
        }

        .pricing-card p strong {
            color: #212529;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .nav-tab {
                flex: 1;
                min-width: 120px;
            }

            .tab-content {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó Admin Pricing Dashboard</h1>
            <p>Manage comprehensive pricing for all four services: Towing, Flatbed, Wheel Lift & Jumpstart</p>
        </div>

        <!-- Authentication Section -->
        <div style="background: #f8f9fa; padding: 20px; border-bottom: 1px solid #dee2e6;">
            <h3 style="margin-bottom: 15px; color: #2c3e50;">üîê Authentication</h3>
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                <input type="text" id="jwt-token" placeholder="Enter your admin JWT token" style="flex: 1; min-width: 300px; padding: 10px; border: 2px solid #e9ecef; border-radius: 5px;">
                <button class="btn btn-primary" onclick="setToken()">Set Token</button>
                <button class="btn btn-warning" onclick="clearToken()">Clear Token</button>
                <span id="token-status" style="color: #666; font-weight: 500;">No token set</span>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">üìä Overview</button>
            <button class="nav-tab" onclick="showTab('base-pricing')">üí∞ Base Pricing</button>
            <button class="nav-tab" onclick="showTab('service-rates')">üöõ Service Rates</button>
            <button class="nav-tab" onclick="showTab('charges')">‚ö° Additional Charges</button>
            <button class="nav-tab" onclick="showTab('features')">üéØ Features</button>
            <button class="nav-tab" onclick="showTab('item-pricing')">üì¶ Item Pricing</button>
            <button class="nav-tab" onclick="showTab('bulk-update')">üîÑ Bulk Update</button>
        </div>

        <div id="alert-container"></div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="form-section">
                <h3>üìà Current Pricing Configuration</h3>
                <button class="btn btn-primary" onclick="loadCurrentConfig()">üîÑ Load Current Settings</button>
                <div id="current-config" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Base Pricing Tab -->
        <div id="base-pricing" class="tab-content">
            <div class="form-section">
                <h3>üí∞ Base Fare Configuration</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Base Fare Amount (AED)</label>
                        <input type="number" id="baseFareAmount" step="0.01" placeholder="50.00">
                    </div>
                    <div class="form-group">
                        <label>Coverage Distance (KM)</label>
                        <input type="number" id="baseFareCoverage" step="0.1" placeholder="6.0">
                    </div>
                    <div class="form-group">
                        <label>Minimum Fare (AED)</label>
                        <input type="number" id="minimumFare" step="0.01" placeholder="50.00">
                    </div>
                </div>
                <button class="btn btn-success" onclick="updateBaseFare()">üíæ Update Base Fare</button>
            </div>

            <div class="form-section">
                <h3>üõ£Ô∏è Per KM Rates</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Rate After Base Coverage (AED/KM)</label>
                        <input type="number" id="perKmRate" step="0.01" placeholder="7.50">
                    </div>
                    <div class="form-group">
                        <label>City-wise Adjustment Above (KM)</label>
                        <input type="number" id="cityWiseAboveKm" step="0.1" placeholder="10.0">
                    </div>
                    <div class="form-group">
                        <label>Adjusted Rate (AED/KM)</label>
                        <input type="number" id="cityWiseAdjustedRate" step="0.01" placeholder="5.00">
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="cityWiseEnabled">
                            <label>Enable City-wise Adjustment</label>
                        </div>
                    </div>
                </div>
                <button class="btn btn-success" onclick="updatePerKmRates()">üíæ Update Per KM Rates</button>
            </div>

            <div class="form-section">
                <h3>üè¢ Platform Fees</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Total Platform Fee (%)</label>
                        <input type="number" id="platformFeePercentage" step="0.1" placeholder="15.0">
                    </div>
                    <div class="form-group">
                        <label>Driver Share (%)</label>
                        <input type="number" id="platformFeeDriverShare" step="0.1" placeholder="7.5">
                    </div>
                    <div class="form-group">
                        <label>Customer Share (%)</label>
                        <input type="number" id="platformFeeCustomerShare" step="0.1" placeholder="7.5">
                    </div>
                </div>
                <button class="btn btn-success" onclick="updatePlatformFees()">üíæ Update Platform Fees</button>
            </div>
        </div>

        <!-- Service Rates Tab -->
        <div id="service-rates" class="tab-content">
            <div class="service-rates">
                <!-- Car Recovery Services -->
                <div class="service-card">
                    <h4>üöõ Car Recovery Services</h4>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="carRecoveryEnabled">
                            <label>Enable Car Recovery</label>
                        </div>
                    </div>
                    
                    <h5>Flatbed Service</h5>
                    <div class="form-group">
                        <label>Per KM Rate (AED)</label>
                        <input type="number" id="flatbedPerKmRate" step="0.01" placeholder="3.50">
                    </div>
                    
                    <h5>Wheel Lift Service</h5>
                    <div class="form-group">
                        <label>Per KM Rate (AED)</label>
                        <input type="number" id="wheelLiftPerKmRate" step="0.01" placeholder="3.00">
                    </div>
                    
                    <h5>Jumpstart Service</h5>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="jumpstartFixedRate">
                            <label>Fixed Rate</label>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Minimum Amount (AED)</label>
                            <input type="number" id="jumpstartMinAmount" step="0.01" placeholder="50.00">
                        </div>
                        <div class="form-group">
                            <label>Maximum Amount (AED)</label>
                            <input type="number" id="jumpstartMaxAmount" step="0.01" placeholder="70.00">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="updateCarRecoveryRates()">üíæ Update Car Recovery</button>
                </div>

                <!-- Car Cab Services -->
                <div class="service-card">
                    <h4>üöó Car Cab Services</h4>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="carCabEnabled">
                            <label>Enable Car Cab</label>
                        </div>
                    </div>
                    
                    <div id="carCabVehicleTypes">
                        <h5>Economy</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Base Fare (AED)</label>
                                <input type="number" id="economyBaseFare" step="0.01" placeholder="50.00">
                            </div>
                            <div class="form-group">
                                <label>Per KM Rate (AED)</label>
                                <input type="number" id="economyPerKmRate" step="0.01" placeholder="7.50">
                            </div>
                        </div>
                        
                        <h5>Premium</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Base Fare (AED)</label>
                                <input type="number" id="premiumBaseFare" step="0.01" placeholder="60.00">
                            </div>
                            <div class="form-group">
                                <label>Per KM Rate (AED)</label>
                                <input type="number" id="premiumPerKmRate" step="0.01" placeholder="9.00">
                            </div>
                        </div>
                        
                        <h5>Luxury</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Base Fare (AED)</label>
                                <input type="number" id="luxuryBaseFare" step="0.01" placeholder="80.00">
                            </div>
                            <div class="form-group">
                                <label>Per KM Rate (AED)</label>
                                <input type="number" id="luxuryPerKmRate" step="0.01" placeholder="12.00">
                            </div>
                        </div>
                        
                        <h5>XL</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Base Fare (AED)</label>
                                <input type="number" id="xlBaseFare" step="0.01" placeholder="70.00">
                            </div>
                            <div class="form-group">
                                <label>Per KM Rate (AED)</label>
                                <input type="number" id="xlPerKmRate" step="0.01" placeholder="10.00">
                            </div>
                        </div>
                        
                        <h5>Family</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Base Fare (AED)</label>
                                <input type="number" id="familyBaseFare" step="0.01" placeholder="65.00">
                            </div>
                            <div class="form-group">
                                <label>Per KM Rate (AED)</label>
                                <input type="number" id="familyPerKmRate" step="0.01" placeholder="8.50">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="updateCarCabRates()">üíæ Update Car Cab</button>
                </div>

                <!-- Bike Services -->
                <div class="service-card">
                    <h4>üèçÔ∏è Bike Services</h4>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="bikeEnabled">
                            <label>Enable Bike Service</label>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Base Fare (AED)</label>
                            <input type="number" id="bikeBaseFare" step="0.01" placeholder="25.00">
                        </div>
                        <div class="form-group">
                            <label>Per KM Rate (AED)</label>
                            <input type="number" id="bikePerKmRate" step="0.01" placeholder="4.00">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="updateBikeRates()">üíæ Update Bike Service</button>
                </div>
            </div>
        </div>

        <!-- Additional Charges Tab -->
        <div id="charges" class="tab-content">
            <div class="form-section">
                <h3>‚ùå Cancellation Charges</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Before Arrival (AED)</label>
                        <input type="number" id="cancellationBeforeArrival" step="0.01" placeholder="2.00">
                    </div>
                    <div class="form-group">
                        <label>After 25% Distance (AED)</label>
                        <input type="number" id="cancellationAfter25Percent" step="0.01" placeholder="5.00">
                    </div>
                    <div class="form-group">
                        <label>After 50% Distance (AED)</label>
                        <input type="number" id="cancellationAfter50Percent" step="0.01" placeholder="5.00">
                    </div>
                    <div class="form-group">
                        <label>After Arrival (AED)</label>
                        <input type="number" id="cancellationAfterArrival" step="0.01" placeholder="10.00">
                    </div>
                </div>
                <button class="btn btn-success" onclick="updateCancellationCharges()">üíæ Update Cancellation Charges</button>
            </div>

            <div class="form-section">
                <h3>‚è∞ Waiting Charges</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Free Minutes</label>
                        <input type="number" id="waitingFreeMinutes" placeholder="5">
                    </div>
                    <div class="form-group">
                        <label>Per Minute Rate (AED)</label>
                        <input type="number" id="waitingPerMinuteRate" step="0.01" placeholder="2.00">
                    </div>
                    <div class="form-group">
                        <label>Maximum Charge (AED)</label>
                        <input type="number" id="waitingMaximumCharge" step="0.01" placeholder="20.00">
                    </div>
                </div>
                <button class="btn btn-success" onclick="updateWaitingCharges()">üíæ Update Waiting Charges</button>
            </div>

            <div class="form-section">
                <h3>üåô Night Charges</h3>
                <div class="form-row">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="nightChargesEnabled">
                            <label>Enable Night Charges</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Start Hour (24h format)</label>
                        <input type="number" id="nightStartHour" min="0" max="23" placeholder="22">
                    </div>
                    <div class="form-group">
                        <label>End Hour (24h format)</label>
                        <input type="number" id="nightEndHour" min="0" max="23" placeholder="6">
                    </div>
                    <div class="form-group">
                        <label>Fixed Amount (AED)</label>
                        <input type="number" id="nightFixedAmount" step="0.01" placeholder="10.00">
                    </div>
                    <div class="form-group">
                        <label>Multiplier</label>
                        <input type="number" id="nightMultiplier" step="0.01" placeholder="1.25">
                    </div>
                </div>
                <button class="btn btn-success" onclick="updateNightCharges()">üíæ Update Night Charges</button>
            </div>

            <div class="form-section">
                <h3>üìà Surge Pricing</h3>
                <div class="form-row">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="surgePricingEnabled">
                            <label>Enable Surge Pricing</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="surgePricingAdminControlled">
                            <label>Admin Controlled</label>
                        </div>
                    </div>
                </div>
                <div id="surgeLevels">
                    <h5>Surge Level 1</h5>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Demand Ratio</label>
                            <input type="number" id="surgeLevel1DemandRatio" step="0.1" placeholder="2.0">
                        </div>
                        <div class="form-group">
                            <label>Multiplier</label>
                            <input type="number" id="surgeLevel1Multiplier" step="0.1" placeholder="1.5">
                        </div>
                    </div>
                    
                    <h5>Surge Level 2</h5>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Demand Ratio</label>
                            <input type="number" id="surgeLevel2DemandRatio" step="0.1" placeholder="3.0">
                        </div>
                        <div class="form-group">
                            <label>Multiplier</label>
                            <input type="number" id="surgeLevel2Multiplier" step="0.1" placeholder="2.0">
                        </div>
                    </div>
                </div>
                <button class="btn btn-success" onclick="updateSurgePricing()">üíæ Update Surge Pricing</button>
            </div>

            <div class="form-section">
                <h3>üíº VAT Configuration</h3>
                <div class="form-row">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="vatEnabled">
                            <label>Enable VAT</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>VAT Percentage (%)</label>
                        <input type="number" id="vatPercentage" step="0.1" placeholder="5.0">
                    </div>
                </div>
                <button class="btn btn-success" onclick="updateVATConfiguration()">üíæ Update VAT</button>
            </div>
        </div>

        <!-- Features Tab -->
        <div id="features" class="tab-content">
            <div class="form-section">
                <h3>üîÑ Round Trip Features</h3>
                
                <h4>Free Stay Minutes</h4>
                <div class="form-row">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="freeStayMinutesEnabled">
                            <label>Enable Free Stay Minutes</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Rate Per KM (minutes)</label>
                        <input type="number" id="freeStayRatePerKm" step="0.1" placeholder="0.5">
                    </div>
                    <div class="form-group">
                        <label>Maximum Minutes</label>
                        <input type="number" id="freeStayMaximumMinutes" placeholder="60">
                    </div>
                </div>
                
                <h4>Refreshment Alert</h4>
                <div class="form-row">
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="refreshmentAlertEnabled">
                            <label>Enable Refreshment Alert</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Minimum Distance (KM)</label>
                        <input type="number" id="refreshmentMinimumDistance" step="0.1" placeholder="20.0">
                    </div>
                    <div class="form-group">
                        <label>Minimum Duration (minutes)</label>
                        <input type="number" id="refreshmentMinimumDuration" placeholder="30">
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="updateRoundTripFeatures()">üíæ Update Round Trip Features</button>
            </div>
        </div>

        <!-- Item Pricing Tab -->
        <div id="item-pricing" class="tab-content">
            <div class="form-section">
                <h3>üì¶ Item Pricing Management (Shifting & Movers)</h3>
                
                <!-- Current Item Pricing Display -->
                <div class="form-section">
                    <h4>Current Item Pricing</h4>
                    <div id="currentItemPricing" class="pricing-display">
                        <p>Loading item pricing...</p>
                    </div>
                    <button class="btn btn-primary" onclick="loadItemPricing()">üîÑ Refresh Item Pricing</button>
                </div>
                
                <!-- Add New Item Pricing -->
                <div class="form-section">
                    <h4>Add New Item Pricing</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Item Name</label>
                            <select id="newItemName">
                                <option value="">Select Item</option>
                                <option value="fridge">Fridge</option>
                                <option value="bed">Bed</option>
                                <option value="sofa">Sofa</option>
                                <option value="wardrobe">Wardrobe</option>
                                <option value="dining_table">Dining Table</option>
                                <option value="washing_machine">Washing Machine</option>
                                <option value="tv">TV</option>
                                <option value="ac">AC</option>
                                <option value="microwave">Microwave</option>
                                <option value="chair">Chair</option>
                                <option value="table">Table</option>
                                <option value="cupboard">Cupboard</option>
                                <option value="bookshelf">Bookshelf</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Stairs Fare Per Floor (‚Çπ)</label>
                            <input type="number" id="newStairsFarePerFloor" step="0.01" placeholder="50.00">
                        </div>
                        <div class="form-group">
                            <label>Lift Fare Per Item (‚Çπ)</label>
                            <input type="number" id="newLiftFarePerItem" step="0.01" placeholder="25.00">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Packing Fare (‚Çπ)</label>
                            <input type="number" id="newPackingFare" step="0.01" placeholder="100.00">
                        </div>
                        <div class="form-group">
                            <label>Fixing Fare (‚Çπ)</label>
                            <input type="number" id="newFixingFare" step="0.01" placeholder="150.00">
                        </div>
                        <div class="form-group">
                            <label>Loading/Unloading Fare (‚Çπ)</label>
                            <input type="number" id="newLoadingUnloadingFare" step="0.01" placeholder="75.00">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="addItemPricing()">‚ûï Add Item Pricing</button>
                </div>
                
                <!-- Update Existing Item Pricing -->
                <div class="form-section">
                    <h4>Update Existing Item Pricing</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Select Item to Update</label>
                            <select id="updateItemName" onchange="loadItemForUpdate()">
                                <option value="">Select Item</option>
                            </select>
                        </div>
                    </div>
                    <div id="updateItemForm" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Stairs Fare Per Floor (‚Çπ)</label>
                                <input type="number" id="updateStairsFarePerFloor" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Lift Fare Per Item (‚Çπ)</label>
                                <input type="number" id="updateLiftFarePerItem" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Packing Fare (‚Çπ)</label>
                                <input type="number" id="updatePackingFare" step="0.01">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Fixing Fare (‚Çπ)</label>
                                <input type="number" id="updateFixingFare" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Loading/Unloading Fare (‚Çπ)</label>
                                <input type="number" id="updateLoadingUnloadingFare" step="0.01">
                            </div>
                        </div>
                        <div class="form-row">
                            <button class="btn btn-warning" onclick="updateItemPricing()">‚úèÔ∏è Update Item Pricing</button>
                            <button class="btn btn-danger" onclick="deleteItemPricing()">üóëÔ∏è Delete Item Pricing</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Update Tab -->
        <div id="bulk-update" class="tab-content">
            <div class="form-section">
                <h3>üîÑ Bulk Update Configuration</h3>
                <p>Upload a JSON configuration to update all pricing settings at once.</p>
                
                <div class="form-group">
                    <label>JSON Configuration</label>
                    <textarea id="bulkUpdateJson" rows="20" style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; font-family: monospace;" placeholder='{
  "baseFare": {
    "amount": 50,
    "coverageKm": 6
  },
  "perKmRate": {
    "afterBaseCoverage": 7.5
  },
  ...
}'></textarea>
                </div>
                
                <div class="form-row">
                    <button class="btn btn-primary" onclick="loadCurrentConfigToJson()">üì• Load Current Config</button>
                    <button class="btn btn-warning" onclick="validateJson()">‚úÖ Validate JSON</button>
                    <button class="btn btn-success" onclick="bulkUpdatePricing()">üöÄ Apply Bulk Update</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/admin/comprehensive-pricing';
        let currentConfig = null;

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }

        // Alert management
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = message;
            
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Token management
        function setToken() {
            const token = document.getElementById('jwt-token').value.trim();
            if (token) {
                localStorage.setItem('adminToken', token);
                document.getElementById('token-status').textContent = 'Token set ‚úÖ';
                document.getElementById('token-status').style.color = '#28a745';
                showAlert('‚úÖ Token set successfully!');
            } else {
                showAlert('‚ùå Please enter a valid token', 'error');
            }
        }

        function clearToken() {
            localStorage.removeItem('adminToken');
            document.getElementById('jwt-token').value = '';
            document.getElementById('token-status').textContent = 'No token set';
            document.getElementById('token-status').style.color = '#666';
            showAlert('üóëÔ∏è Token cleared');
        }

        function getToken() {
            return localStorage.getItem('adminToken');
        }

        // Check token status on load
        function checkTokenStatus() {
            const token = getToken();
            if (token) {
                document.getElementById('jwt-token').value = token;
                document.getElementById('token-status').textContent = 'Token set ‚úÖ';
                document.getElementById('token-status').style.color = '#28a745';
            }
        }

        // API request helper
        async function apiRequest(endpoint, method = 'GET', data = null) {
            try {
                const token = localStorage.getItem('adminToken');
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (token) {
                    options.headers['Authorization'] = `Bearer ${token}`;
                }
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(API_BASE + endpoint, options);
                const result = await response.json();
                
                if (!response.ok) {
                    if (response.status === 401) {
                        showAlert('‚ùå Authentication failed. Please check your token.', 'error');
                    }
                    throw new Error(result.message || 'Request failed');
                }
                
                return result;
            } catch (error) {
                console.error('API Error:', error);
                showAlert(`Error: ${error.message}`, 'error');
                throw error;
            }
        }

        // Load current configuration
        async function loadCurrentConfig() {
            try {
                const result = await apiRequest('/');
                currentConfig = result.data;
                
                // Display current config
                const configDiv = document.getElementById('current-config');
                configDiv.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <h4>üìä Current Configuration</h4>
                        <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto;">${JSON.stringify(currentConfig, null, 2)}</pre>
                    </div>
                `;
                
                // Populate form fields
                populateFormFields(currentConfig);
                
                showAlert('‚úÖ Configuration loaded successfully!');
            } catch (error) {
                showAlert('‚ùå Failed to load configuration', 'error');
            }
        }

        // Populate form fields with current config
        function populateFormFields(config) {
            // Base fare
            document.getElementById('baseFareAmount').value = config.baseFare?.amount || '';
            document.getElementById('baseFareCoverage').value = config.baseFare?.coverageKm || '';
            document.getElementById('minimumFare').value = config.minimumFare || '';
            
            // Per KM rates
            document.getElementById('perKmRate').value = config.perKmRate?.afterBaseCoverage || '';
            document.getElementById('cityWiseAboveKm').value = config.perKmRate?.cityWiseAdjustment?.aboveKm || '';
            document.getElementById('cityWiseAdjustedRate').value = config.perKmRate?.cityWiseAdjustment?.adjustedRate || '';
            document.getElementById('cityWiseEnabled').checked = config.perKmRate?.cityWiseAdjustment?.enabled || false;
            
            // Platform fees
            document.getElementById('platformFeePercentage').value = config.platformFee?.percentage || '';
            document.getElementById('platformFeeDriverShare').value = config.platformFee?.driverShare || '';
            document.getElementById('platformFeeCustomerShare').value = config.platformFee?.customerShare || '';
            
            // Car recovery
            document.getElementById('carRecoveryEnabled').checked = config.serviceTypes?.carRecovery?.enabled || false;
            document.getElementById('flatbedPerKmRate').value = config.serviceTypes?.carRecovery?.flatbed?.perKmRate || '';
            document.getElementById('wheelLiftPerKmRate').value = config.serviceTypes?.carRecovery?.wheelLift?.perKmRate || '';
            document.getElementById('jumpstartFixedRate').checked = config.serviceTypes?.carRecovery?.jumpstart?.fixedRate || false;
            document.getElementById('jumpstartMinAmount').value = config.serviceTypes?.carRecovery?.jumpstart?.minAmount || '';
            document.getElementById('jumpstartMaxAmount').value = config.serviceTypes?.carRecovery?.jumpstart?.maxAmount || '';
            
            // Car cab
            document.getElementById('carCabEnabled').checked = config.serviceTypes?.carCab?.enabled || false;
            const vehicleTypes = config.serviceTypes?.carCab?.vehicleTypes || {};
            ['economy', 'premium', 'luxury', 'xl', 'family'].forEach(type => {
                document.getElementById(`${type}BaseFare`).value = vehicleTypes[type]?.baseFare || '';
                document.getElementById(`${type}PerKmRate`).value = vehicleTypes[type]?.perKmRate || '';
            });
            
            // Bike
            document.getElementById('bikeEnabled').checked = config.serviceTypes?.bike?.enabled || false;
            document.getElementById('bikeBaseFare').value = config.serviceTypes?.bike?.baseFare || '';
            document.getElementById('bikePerKmRate').value = config.serviceTypes?.bike?.perKmRate || '';
            
            // Cancellation charges
            document.getElementById('cancellationBeforeArrival').value = config.cancellationCharges?.beforeArrival || '';
            document.getElementById('cancellationAfter25Percent').value = config.cancellationCharges?.after25PercentDistance || '';
            document.getElementById('cancellationAfter50Percent').value = config.cancellationCharges?.after50PercentDistance || '';
            document.getElementById('cancellationAfterArrival').value = config.cancellationCharges?.afterArrival || '';
            
            // Waiting charges
            document.getElementById('waitingFreeMinutes').value = config.waitingCharges?.freeMinutes || '';
            document.getElementById('waitingPerMinuteRate').value = config.waitingCharges?.perMinuteRate || '';
            document.getElementById('waitingMaximumCharge').value = config.waitingCharges?.maximumCharge || '';
            
            // Night charges
            document.getElementById('nightChargesEnabled').checked = config.nightCharges?.enabled || false;
            document.getElementById('nightStartHour').value = config.nightCharges?.startHour || '';
            document.getElementById('nightEndHour').value = config.nightCharges?.endHour || '';
            document.getElementById('nightFixedAmount').value = config.nightCharges?.fixedAmount || '';
            document.getElementById('nightMultiplier').value = config.nightCharges?.multiplier || '';
            
            // Surge pricing
            document.getElementById('surgePricingEnabled').checked = config.surgePricing?.enabled || false;
            document.getElementById('surgePricingAdminControlled').checked = config.surgePricing?.adminControlled || false;
            if (config.surgePricing?.levels?.length >= 2) {
                document.getElementById('surgeLevel1DemandRatio').value = config.surgePricing.levels[0]?.demandRatio || '';
                document.getElementById('surgeLevel1Multiplier').value = config.surgePricing.levels[0]?.multiplier || '';
                document.getElementById('surgeLevel2DemandRatio').value = config.surgePricing.levels[1]?.demandRatio || '';
                document.getElementById('surgeLevel2Multiplier').value = config.surgePricing.levels[1]?.multiplier || '';
            }
            
            // VAT
            document.getElementById('vatEnabled').checked = config.vat?.enabled || false;
            document.getElementById('vatPercentage').value = config.vat?.percentage || '';
            
            // Round trip features
            document.getElementById('freeStayMinutesEnabled').checked = config.roundTrip?.freeStayMinutes?.enabled || false;
            document.getElementById('freeStayRatePerKm').value = config.roundTrip?.freeStayMinutes?.ratePerKm || '';
            document.getElementById('freeStayMaximumMinutes').value = config.roundTrip?.freeStayMinutes?.maximumMinutes || '';
            document.getElementById('refreshmentAlertEnabled').checked = config.roundTrip?.refreshmentAlert?.enabled || false;
            document.getElementById('refreshmentMinimumDistance').value = config.roundTrip?.refreshmentAlert?.minimumDistance || '';
            document.getElementById('refreshmentMinimumDuration').value = config.roundTrip?.refreshmentAlert?.minimumDuration || '';
        }

        // Update functions
        async function updateBaseFare() {
            const data = {
                amount: parseFloat(document.getElementById('baseFareAmount').value),
                coverageKm: parseFloat(document.getElementById('baseFareCoverage').value)
            };
            
            try {
                await apiRequest('/base-fare', 'PUT', data);
                showAlert('‚úÖ Base fare updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updatePerKmRates() {
            const data = {
                afterBaseCoverage: parseFloat(document.getElementById('perKmRate').value),
                cityWiseAdjustment: {
                    enabled: document.getElementById('cityWiseEnabled').checked,
                    aboveKm: parseFloat(document.getElementById('cityWiseAboveKm').value),
                    adjustedRate: parseFloat(document.getElementById('cityWiseAdjustedRate').value)
                }
            };
            
            try {
                await apiRequest('/per-km-rates', 'PUT', data);
                showAlert('‚úÖ Per KM rates updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updatePlatformFees() {
            const data = {
                percentage: parseFloat(document.getElementById('platformFeePercentage').value),
                driverShare: parseFloat(document.getElementById('platformFeeDriverShare').value),
                customerShare: parseFloat(document.getElementById('platformFeeCustomerShare').value)
            };
            
            try {
                await apiRequest('/platform-fees', 'PUT', data);
                showAlert('‚úÖ Platform fees updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateCarRecoveryRates() {
            const data = {
                enabled: document.getElementById('carRecoveryEnabled').checked,
                flatbed: {
                    perKmRate: parseFloat(document.getElementById('flatbedPerKmRate').value)
                },
                wheelLift: {
                    perKmRate: parseFloat(document.getElementById('wheelLiftPerKmRate').value)
                },
                jumpstart: {
                    fixedRate: document.getElementById('jumpstartFixedRate').checked,
                    minAmount: parseFloat(document.getElementById('jumpstartMinAmount').value),
                    maxAmount: parseFloat(document.getElementById('jumpstartMaxAmount').value)
                }
            };
            
            try {
                await apiRequest('/car-recovery-rates', 'PUT', data);
                showAlert('‚úÖ Car recovery rates updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateCarCabRates() {
            const vehicleTypes = {};
            ['economy', 'premium', 'luxury', 'xl', 'family'].forEach(type => {
                vehicleTypes[type] = {
                    baseFare: parseFloat(document.getElementById(`${type}BaseFare`).value),
                    perKmRate: parseFloat(document.getElementById(`${type}PerKmRate`).value)
                };
            });
            
            const data = {
                enabled: document.getElementById('carCabEnabled').checked,
                vehicleTypes
            };
            
            try {
                await apiRequest('/car-cab-rates', 'PUT', data);
                showAlert('‚úÖ Car cab rates updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateBikeRates() {
            const data = {
                enabled: document.getElementById('bikeEnabled').checked,
                baseFare: parseFloat(document.getElementById('bikeBaseFare').value),
                perKmRate: parseFloat(document.getElementById('bikePerKmRate').value)
            };
            
            try {
                await apiRequest('/bike-rates', 'PUT', data);
                showAlert('‚úÖ Bike rates updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateCancellationCharges() {
            const data = {
                beforeArrival: parseFloat(document.getElementById('cancellationBeforeArrival').value),
                after25PercentDistance: parseFloat(document.getElementById('cancellationAfter25Percent').value),
                after50PercentDistance: parseFloat(document.getElementById('cancellationAfter50Percent').value),
                afterArrival: parseFloat(document.getElementById('cancellationAfterArrival').value)
            };
            
            try {
                await apiRequest('/cancellation-charges', 'PUT', data);
                showAlert('‚úÖ Cancellation charges updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateWaitingCharges() {
            const data = {
                freeMinutes: parseInt(document.getElementById('waitingFreeMinutes').value),
                perMinuteRate: parseFloat(document.getElementById('waitingPerMinuteRate').value),
                maximumCharge: parseFloat(document.getElementById('waitingMaximumCharge').value)
            };
            
            try {
                await apiRequest('/waiting-charges', 'PUT', data);
                showAlert('‚úÖ Waiting charges updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateNightCharges() {
            const data = {
                enabled: document.getElementById('nightChargesEnabled').checked,
                startHour: parseInt(document.getElementById('nightStartHour').value),
                endHour: parseInt(document.getElementById('nightEndHour').value),
                fixedAmount: parseFloat(document.getElementById('nightFixedAmount').value),
                multiplier: parseFloat(document.getElementById('nightMultiplier').value)
            };
            
            try {
                await apiRequest('/night-charges', 'PUT', data);
                showAlert('‚úÖ Night charges updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateSurgePricing() {
            const data = {
                enabled: document.getElementById('surgePricingEnabled').checked,
                adminControlled: document.getElementById('surgePricingAdminControlled').checked,
                levels: [
                    {
                        demandRatio: parseFloat(document.getElementById('surgeLevel1DemandRatio').value),
                        multiplier: parseFloat(document.getElementById('surgeLevel1Multiplier').value)
                    },
                    {
                        demandRatio: parseFloat(document.getElementById('surgeLevel2DemandRatio').value),
                        multiplier: parseFloat(document.getElementById('surgeLevel2Multiplier').value)
                    }
                ]
            };
            
            try {
                await apiRequest('/surge-pricing', 'PUT', data);
                showAlert('‚úÖ Surge pricing updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateVATConfiguration() {
            const data = {
                enabled: document.getElementById('vatEnabled').checked,
                percentage: parseFloat(document.getElementById('vatPercentage').value)
            };
            
            try {
                await apiRequest('/vat-configuration', 'PUT', data);
                showAlert('‚úÖ VAT configuration updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function updateRoundTripFeatures() {
            const data = {
                freeStayMinutes: {
                    enabled: document.getElementById('freeStayMinutesEnabled').checked,
                    ratePerKm: parseFloat(document.getElementById('freeStayRatePerKm').value),
                    maximumMinutes: parseInt(document.getElementById('freeStayMaximumMinutes').value)
                },
                refreshmentAlert: {
                    enabled: document.getElementById('refreshmentAlertEnabled').checked,
                    minimumDistance: parseFloat(document.getElementById('refreshmentMinimumDistance').value),
                    minimumDuration: parseInt(document.getElementById('refreshmentMinimumDuration').value)
                }
            };
            
            try {
                await apiRequest('/round-trip-features', 'PUT', data);
                showAlert('‚úÖ Round trip features updated successfully!');
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        // Bulk update functions
        function loadCurrentConfigToJson() {
            if (currentConfig) {
                document.getElementById('bulkUpdateJson').value = JSON.stringify(currentConfig, null, 2);
                showAlert('‚úÖ Current configuration loaded to JSON editor!');
            } else {
                showAlert('‚ùå Please load current configuration first', 'error');
            }
        }

        function validateJson() {
            try {
                const jsonText = document.getElementById('bulkUpdateJson').value;
                JSON.parse(jsonText);
                showAlert('‚úÖ JSON is valid!');
            } catch (error) {
                showAlert(`‚ùå Invalid JSON: ${error.message}`, 'error');
            }
        }

        async function bulkUpdatePricing() {
            try {
                const jsonText = document.getElementById('bulkUpdateJson').value;
                const data = JSON.parse(jsonText);
                
                await apiRequest('/bulk-update', 'PUT', data);
                showAlert('‚úÖ Bulk update completed successfully!');
                
                // Reload current config
                await loadCurrentConfig();
            } catch (error) {
                if (error.message.includes('JSON')) {
                    showAlert(`‚ùå Invalid JSON: ${error.message}`, 'error');
                }
                // Other errors already handled in apiRequest
            }
        }

        // Item Pricing Management Functions
        async function loadItemPricing() {
            try {
                const response = await apiRequest('/item-pricing', 'GET');
                displayItemPricing(response.data);
                populateUpdateItemSelect(response.data);
            } catch (error) {
                document.getElementById('currentItemPricing').innerHTML = '<p style="color: red;">Failed to load item pricing</p>';
            }
        }

        function displayItemPricing(itemPricing) {
            const container = document.getElementById('currentItemPricing');
            if (!itemPricing || itemPricing.length === 0) {
                container.innerHTML = '<p>No item pricing configured</p>';
                return;
            }

            let html = '<div class="pricing-grid">';
            itemPricing.forEach(item => {
                html += `
                    <div class="pricing-card">
                        <h4>${item.itemName.charAt(0).toUpperCase() + item.itemName.slice(1).replace('_', ' ')}</h4>
                        <p><strong>Stairs Fare:</strong> ‚Çπ${item.stairsFarePerFloor}/floor</p>
                        <p><strong>Lift Fare:</strong> ‚Çπ${item.liftFarePerItem}/item</p>
                        <p><strong>Packing:</strong> ‚Çπ${item.packingFare}</p>
                        <p><strong>Fixing:</strong> ‚Çπ${item.fixingFare}</p>
                        <p><strong>Loading/Unloading:</strong> ‚Çπ${item.loadingUnloadingFare}</p>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function populateUpdateItemSelect(itemPricing) {
            const select = document.getElementById('updateItemName');
            select.innerHTML = '<option value="">Select Item</option>';
            
            if (itemPricing && itemPricing.length > 0) {
                itemPricing.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.itemName;
                    option.textContent = item.itemName.charAt(0).toUpperCase() + item.itemName.slice(1).replace('_', ' ');
                    select.appendChild(option);
                });
            }
        }

        async function addItemPricing() {
            const itemName = document.getElementById('newItemName').value;
            const stairsFarePerFloor = parseFloat(document.getElementById('newStairsFarePerFloor').value);
            const liftFarePerItem = parseFloat(document.getElementById('newLiftFarePerItem').value);
            const packingFare = parseFloat(document.getElementById('newPackingFare').value);
            const fixingFare = parseFloat(document.getElementById('newFixingFare').value);
            const loadingUnloadingFare = parseFloat(document.getElementById('newLoadingUnloadingFare').value);

            if (!itemName) {
                showAlert('‚ùå Please select an item name', 'error');
                return;
            }

            const data = {
                itemName,
                stairsFarePerFloor,
                liftFarePerItem,
                packingFare,
                fixingFare,
                loadingUnloadingFare
            };

            try {
                await apiRequest('/item-pricing', 'POST', data);
                showAlert('‚úÖ Item pricing added successfully!');
                
                // Clear form
                document.getElementById('newItemName').value = '';
                document.getElementById('newStairsFarePerFloor').value = '';
                document.getElementById('newLiftFarePerItem').value = '';
                document.getElementById('newPackingFare').value = '';
                document.getElementById('newFixingFare').value = '';
                document.getElementById('newLoadingUnloadingFare').value = '';
                
                // Reload item pricing
                loadItemPricing();
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function loadItemForUpdate() {
            const itemName = document.getElementById('updateItemName').value;
            const updateForm = document.getElementById('updateItemForm');
            
            if (!itemName) {
                updateForm.style.display = 'none';
                return;
            }

            try {
                const response = await apiRequest('/item-pricing', 'GET');
                const item = response.data.find(i => i.itemName === itemName);
                
                if (item) {
                    document.getElementById('updateStairsFarePerFloor').value = item.stairsFarePerFloor;
                    document.getElementById('updateLiftFarePerItem').value = item.liftFarePerItem;
                    document.getElementById('updatePackingFare').value = item.packingFare;
                    document.getElementById('updateFixingFare').value = item.fixingFare;
                    document.getElementById('updateLoadingUnloadingFare').value = item.loadingUnloadingFare;
                    
                    updateForm.style.display = 'block';
                }
            } catch (error) {
                showAlert('‚ùå Failed to load item details', 'error');
            }
        }

        async function updateItemPricing() {
            const itemName = document.getElementById('updateItemName').value;
            
            if (!itemName) {
                showAlert('‚ùå Please select an item to update', 'error');
                return;
            }

            const data = {
                stairsFarePerFloor: parseFloat(document.getElementById('updateStairsFarePerFloor').value),
                liftFarePerItem: parseFloat(document.getElementById('updateLiftFarePerItem').value),
                packingFare: parseFloat(document.getElementById('updatePackingFare').value),
                fixingFare: parseFloat(document.getElementById('updateFixingFare').value),
                loadingUnloadingFare: parseFloat(document.getElementById('updateLoadingUnloadingFare').value)
            };

            try {
                await apiRequest(`/item-pricing/${itemName}`, 'PUT', data);
                showAlert('‚úÖ Item pricing updated successfully!');
                loadItemPricing();
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        async function deleteItemPricing() {
            const itemName = document.getElementById('updateItemName').value;
            
            if (!itemName) {
                showAlert('‚ùå Please select an item to delete', 'error');
                return;
            }

            if (!confirm(`Are you sure you want to delete pricing for ${itemName}?`)) {
                return;
            }

            try {
                await apiRequest(`/item-pricing/${itemName}`, 'DELETE');
                showAlert('‚úÖ Item pricing deleted successfully!');
                
                // Reset form
                document.getElementById('updateItemName').value = '';
                document.getElementById('updateItemForm').style.display = 'none';
                
                loadItemPricing();
            } catch (error) {
                // Error already handled in apiRequest
            }
        }

        // Load configuration on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkTokenStatus();
            loadCurrentConfig();
        });
    </script>
</body>
</html>